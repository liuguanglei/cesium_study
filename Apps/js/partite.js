function Partite(){function g(b){function d(a,b,c,e,d){var v=d3.sum(a),f=0,g=0,k=c-b-2*e*a.length,n=[];a.forEach(function(f){var h={};h.percent=0==v?0:f/v;h.value=f;h.height=Math.max(h.percent*(c-b-2*e*a.length),d);h.height==d?k-=d:g+=h.height;n.push(h)});var h=k/Math.max(g,1),f=0;n.forEach(function(l){l.percent*=h;l.height=l.height==d?d:l.height*h;l.middle=f+e+l.height/2;l.y=b+l.middle-l.percent*(c-b-2*e*a.length)/2;l.h=l.percent*(c-b-2*e*a.length);l.percent=0==v?0:l.value/v;f+=2*e+l.height});return n}
var c={};c.mainBars=[d(b.data[0].map(function(a){return d3.sum(a)}),0,Math.max(h,q),1,14),d(b.data[1].map(function(a){return d3.sum(a)}),0,Math.max(h,q),1,14)];c.subBars=[[],[]];c.mainBars.forEach(function(a,p){a.forEach(function(a,e){d(b.data[p][e],a.y,a.y+a.h,0,0).forEach(function(a,b){a.key1=0==p?e:b;a.key2=0==p?b:e;c.subBars[p].push(a)})})});c.subBars.forEach(function(a){a.sort(function(a,b){return a.key1<b.key1?-1:a.key1>b.key1?1:a.key2<b.key2?-1:a.key2>b.key2?1:0})});c.edges=c.subBars[0].map(function(a,
b){return{key1:a.key1,key2:a.key2,y1:a.y,y2:c.subBars[1][b].y,h1:a.h,h2:c.subBars[1][b].h}});c.keys=b.keys;return c}function r(b){var d=d3.interpolate(this._current,b);this._current=d(0);return function(b){return z(d(b))}}function t(b,d,c,a){d3.select("#"+d).append("g").attr("class","part"+c).attr("transform","translate("+180*c+",0)");d3.select("#"+d).select(".part"+c).append("g").attr("class","subbars");d3.select("#"+d).select(".part"+c).append("g").attr("class","mainbars");var p=d3.select("#"+d).select(".part"+
c).select(".mainbars").selectAll(".mainbar").data(b.mainBars[c]).enter().append("g").attr("class","mainbar");p.append("rect").attr("class","mainrect").attr("shape-rendering","crispEdges").attr("x",0).attr("y",function(a){return a.middle-a.height/2}).attr("width",30).attr("height",function(a){return a.height}).style("shape-rendering","auto").style("fill-opacity",0).style("stroke-width","0.5").style("stroke","black").style("stroke-opacity",0);var m=p.append("text").attr("class","barlabel").attr("x",
w[c]).attr("y",function(a){return a.middle+5}).text(function(a,d){return b.keys[c][d]}).attr("text-anchor","start");k(m,f.typeLabelStyle);m=p.append("text").attr("class","barvalue").attr("x",A[c]).attr("y",function(a){return a.middle+5}).text(function(a,b){return a.value}).attr("text-anchor","end");k(m,f.valueLabelStyle);m=p.append("text").attr("class","barpercent").attr("x",B[c]).attr("y",function(a){return a.middle+5}).text(function(a,b){return"( "+Math.round(100*a.percent)+"%)"}).attr("text-anchor",
"end").style("fill","grey");k(m,f.precentLabelStyle);d3.select("#"+d).select(".part"+c).select(".subbars").selectAll(".subbar").data(b.subBars[c]).enter().append("rect").attr("class","subbar").attr("shape-rendering","crispEdges").attr("x",0).attr("y",function(a){return a.y}).attr("width",30).attr("height",function(a){return a.h}).style("fill",function(b){return C(a,b.key1)})}function F(b,d,c){d3.select("#"+d).append("g").attr("class","edges").attr("transform","translate(30,0)");d3.select("#"+d).select(".edges").selectAll(".edge").data(b.edges).enter().append("polygon").attr("class",
"edge").attr("points",z).style("fill",function(a){return C(c,a.key1)}).style("opacity",.5).each(function(a){this._current=a})}function G(b,d){var c=d3.select("#"+d).append("g").attr("class","header").append("text").text(b[3]).attr("x",108).attr("y",-20).style("text-anchor","middle");k(c,f.mainTitleStyle);[0,1].forEach(function(a){var c=d3.select("#"+d).select(".part"+a).append("g").attr("class","header"),m=c.append("text").text(b[a]).attr("x",w[a]-10).attr("y",-5);k(m,f.subTitleStyle);m=c.append("text").text(b[2]).attr("x",
A[a]-10).attr("y",-5);k(m,f.subTitleStyle);m=c.append("line").attr("x1",w[a]-10).attr("y1",-2).attr("x2",B[a]+10).attr("y2",-2).style("shape-rendering","crispEdges");k(m,f.headSplitLineStye)})}function z(b){return[0,b.y1,150,b.y2,150,b.y2+b.h2,0,b.y1+b.h1].join(" ")}function D(b,d,c){var a=d3.select("#"+d).select(".part"+c).select(".mainbars").selectAll(".mainbar").data(b.mainBars[c]);a.select(".mainrect").transition().duration(500).attr("y",function(a){return a.middle-a.height/2}).attr("height",
function(a){return a.height});a.select(".barlabel").transition().duration(500).attr("y",function(a){return a.middle+5});a.select(".barvalue").transition().duration(500).attr("y",function(a){return a.middle+5}).text(function(a,b){return a.value});a.select(".barpercent").transition().duration(500).attr("y",function(a){return a.middle+5}).text(function(a,b){return"( "+Math.round(100*a.percent)+"%)"});d3.select("#"+d).select(".part"+c).select(".subbars").selectAll(".subbar").data(b.subBars[c]).transition().duration(500).attr("y",
function(a){return a.y}).attr("height",function(a){return a.h})}function H(b,d){d3.select("#"+d).append("g").attr("class","edges").attr("transform","translate(30,0)");d3.select("#"+d).select(".edges").selectAll(".edge").data(b.edges).transition().duration(500).attrTween("points",r).style("opacity",function(b){return 0==b.h1||0==b.h2?0:.5})}function k(b,d){for(var c in d)b.style(c,d[c])}function E(b,d){D(b,d,0);D(b,d,1);H(b,d)}function C(b,d){return d<b.length?b[d]:f.defaultFillColor}var f=this,q=
600,h=14,u=0,w=[-130,40],A=[-50,120],B=[-10,160],x,y,n=[];this.margin={b:0,t:40,l:170,r:50};this.defaultFillColor="#000000";this.colors="#3366CC #DC3912 #FF9900 #109618 #990099 #0099C6".split(" ");this.mainTitleStyle={fill:"#000000","font-size":"20px","font-weight":"bold","font-family":"Arial"};this.subTitleStyle={fill:"grey","font-size":"13px","font-weight":"normal","font-family":"Arial"};this.typeLabelStyle={fill:"#000000","font-size":"12px","font-weight":"normal","font-family":"Arial"};this.valueLabelStyle=
{fill:"#000000","font-size":"12px","font-weight":"normal","font-family":"Arial"};this.precentLabelStyle={fill:"grey","font-size":"12px","font-weight":"normal","font-family":"Arial"};this.headSplitLineStye={stroke:"black","stroke-width":1};this.startRender=function(){n&&0!=n.length&&x&&n.forEach(function(b,d){x.append("g").attr("id",b.id).attr("transform","translate("+550*d+",0)");var c=f.colors;b.hasOwnProperty("fills")&&(c=b.fills);var a=g(b.data);t(a,b.id,0,c);t(a,b.id,1,c);F(a,b.id,c);G(b.header,
b.id,c);[0,1].forEach(function(a){d3.select("#"+b.id).select(".part"+a).select(".mainbars").selectAll(".mainbar").on("mouseover",function(b,c){return f.selectSegment(n,a,c)}).on("mouseout",function(b,c){return f.deSelectSegment(n,a,c)})})})};this.selectSegment=function(b,d,c){b.forEach(function(a){var b={keys:[],data:[]};b.keys=a.data.keys.map(function(a){return a});b.data[d]=a.data.data[d].map(function(a){return a});b.data[1-d]=a.data.data[1-d].map(function(a){return a.map(function(a,b){return c==
b?a:0})});E(g(b),a.id);a=d3.select("#"+a.id).select(".part"+d).select(".mainbars").selectAll(".mainbar").filter(function(a,b){return b==c});a.select(".mainrect").style("stroke-opacity",1);a.select(".barlabel").style("font-weight","bold");a.select(".barvalue").style("font-weight","bold");a.select(".barpercent").style("font-weight","bold")})};this.deSelectSegment=function(b,d,c){b.forEach(function(a){E(g(a.data),a.id);a=d3.select("#"+a.id).select(".part"+d).select(".mainbars").selectAll(".mainbar").filter(function(a,
b){return b==c});a.select(".mainrect").style("stroke-opacity",0);a.select(".barlabel").style("font-weight","normal");a.select(".barvalue").style("font-weight","normal");a.select(".barpercent").style("font-weight","normal")})};this.pushSerie=function(b,d,c,a,g,m){var e={},k=[];b.forEach(function(b){b&&b.hasOwnProperty(d)&&b.hasOwnProperty(c)&&(!a||a&&b.hasOwnProperty(a))&&k.push(b)});e.keys=[d3.set(k.map(function(a){return a[d]})).values().sort(function(a,b){return a<b?-1:a>b?1:0}),d3.set(k.map(function(a){return a[c]})).values().sort(function(a,
b){return a<b?-1:a>b?1:0})];e.data=[e.keys[0].map(function(a){return e.keys[1].map(function(a){return 0})}),e.keys[1].map(function(a){return e.keys[0].map(function(a){return 0})})];k.forEach(function(b){e.data[0][e.keys[0].indexOf(b[d])][e.keys[1].indexOf(b[c])]=a?b[a]:1;e.data[1][e.keys[1].indexOf(b[c])][e.keys[0].indexOf(b[d])]=a?b[a]:1});u=Math.max(u,e.keys[0].length);u=Math.max(u,e.keys[1].length);h=17*u;h>q&&y.attr("height",h+f.margin.b+f.margin.t);b=UUIDUtils.copyObject({data:e,id:UUIDUtils.createNID("svg_id"),
header:g},m);n.push(b);return b};this.createSvg=function(b,d,c,a){q=c;y=d3.select(document.getElementById(b)).append("svg").attr("width",d).attr("height",q+f.margin.b+f.margin.t);return x=y.append("g").attr("transform","translate("+f.margin.l+","+f.margin.t+")")}}function UUIDUtils(){}UUIDUtils.startt="";UUIDUtils.max=999999999999998;UUIDUtils.st=0;UUIDUtils.st1=0;UUIDUtils.st2=0;
UUIDUtils.createNID=function(g){g||(g="");UUIDUtils.st+=1;UUIDUtils.st>=UUIDUtils.max&&(UUIDUtils.st=0,UUIDUtils.st1+=1,UUIDUtils.st1>=UUIDUtils.max&&(UUIDUtils.st2+=1,UUIDUtils.st1=0,UUIDUtils.st2>=UUIDUtils.max&&(UUIDUtils.startt=(new Date).getTime()+""+parseFloat(1E5*Math.random()),UUIDUtils.st=0,UUIDUtils.st1=0,UUIDUtils.st2=0)));return g+"c"+UUIDUtils.st+"h"+UUIDUtils.st1+"o"+UUIDUtils.st2+"n"+UUIDUtils.startt+"g"};UUIDUtils.copyObject=function(g,r){if(r)for(var t in r)g[t]=r[t];return g};